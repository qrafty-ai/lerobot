---
phase: 01-pi-rl-recipe-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lerobot/configs/train.py
  - src/lerobot/configs/types.py
  - src/lerobot/configs/parser.py
autonomous: true
requirements:
  - RCP-01
  - RCP-03
must_haves:
  truths:
    - "User can explicitly select PI-RL recipe independent of policy type field."
    - "Selecting PI-RL without a valid variant fails before runtime starts."
    - "Default behavior remains unchanged when PI-RL recipe is not selected."
  artifacts:
    - path: src/lerobot/configs/train.py
      provides: PI-RL recipe config fields and validation gates
    - path: src/lerobot/configs/types.py
      provides: constrained type aliases/enums for recipe and variant values
    - path: src/lerobot/configs/parser.py
      provides: parse compatibility for new recipe fields through existing wrapper flow
  key_links:
    - from: src/lerobot/configs/parser.py
      to: src/lerobot/configs/train.py
      via: wrapped config parse and validation
      pattern: "@parser.wrap|validate"
    - from: src/lerobot/configs/train.py
      to: runtime entrypoints
      via: validated config object consumed by actor/learner/train scripts
      pattern: "TrainRLServerPipelineConfig|TrainPipelineConfig"
---

<objective>
Define PI-RL as a recipe-level configuration surface with strict, explicit validation behavior.

Purpose: Make recipe selection orthogonal to policy taxonomy while preserving existing defaults.
Output: Config dataclass fields and validation helpers for `recipe=pi-rl` with required variants and actionable error messages.
</objective>

<execution_context>
@/home/cc/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/cc/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-pi-rl-recipe-foundation/01-CONTEXT.md
@.planning/phases/01-pi-rl-recipe-foundation/01-RESEARCH.md
@src/lerobot/configs/train.py
@src/lerobot/configs/parser.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add explicit PI-RL recipe and variant fields to train config</name>
  <files>src/lerobot/configs/train.py, src/lerobot/configs/types.py</files>
  <action>Add a top-level recipe selector and PI-RL variant fields so users can set canonical `pi-rl` plus required `flow-noise` or `flow-sde` modes. Keep defaults preserving existing non-PI-RL behavior when recipe is unset. Define explicit Phase 1 knobs: shared `pirl.temperature` and `pirl.target_noise_scale`, plus variant-specific `pirl.flow_noise.std` and `pirl.flow_sde.sigma_min/sigma_max`; enforce strict typing and clear field names.</action>
  <verify>Run unit-level config parse/construct checks for default config, `recipe=pi-rl + flow-noise`, and `recipe=pi-rl + flow-sde`.</verify>
  <done>Config can represent PI-RL mode explicitly and still round-trip existing non-PI-RL configs without behavior changes.</done>
</task>

<task type="auto">
  <name>Task 2: Implement fail-fast recipe preflight validation with actionable errors</name>
  <files>src/lerobot/configs/train.py, src/lerobot/configs/parser.py</files>
  <action>Implement validation that rejects non-canonical recipe spellings, missing PI-RL variant, and invalid/missing variant knobs. Error messages must include exact invalid field and fix hint (including suggestion to use canonical `pi-rl`). Ensure validation executes before actor/learner startup.</action>
  <verify>Run tests that assert `ValueError` content includes field path, bad value, and correction guidance for each invalid input case.</verify>
  <done>Invalid recipe/variant combinations fail before runtime launch with deterministic, actionable errors.</done>
</task>

</tasks>

<verification>
- Config validation tests pass for default and PI-RL selections.
- Negative tests cover misspelled recipe, missing variant, and invalid variant knobs.
</verification>

<success_criteria>
- PI-RL is selectable via explicit recipe field.
- Variant is required only when PI-RL recipe is selected.
- Existing training flows behave exactly as before when recipe is absent.
</success_criteria>

<output>
After completion, create `.planning/phases/01-pi-rl-recipe-foundation/01-01-SUMMARY.md`
</output>
